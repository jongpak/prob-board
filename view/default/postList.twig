{% extends file('layout') %}

{% block body %}
<h2 class="page-header">Posts <small> / {{ board.getTitle() }}</small></h2>

<table class="table table-hover">
    <thead>
    <tr>
        <th class="no">No.</th>
        <th class="subject">Subject</th>
        <th class="author">Author</th>
        <th class="time">Time</th>
    </tr>
    </thead>
    <tbody>
    {% for post in posts %}
    <tr>
        <td class="no">{{ post.getId() }}</td>
        <td class="subject">
            <a href="{{ readUri(post, searchQuery) }}">
                {{ post.getSubject() }}

                {% if post.getComments | length %}
                    <span class="badge" title="{{ post.getComments | length }} Comments">
                        <span class="glyphicon glyphicon-comment" aria-hidden="true"></span>
                        <span class="hide">comments</span>
                        {{ post.getComments | length }}
                    </span>
                {% endif %}

                {% if post.getAttachemntFiles() | length %}
                    <span class="badge attachments" title="Attachments">
                        <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>
                        <span class="hide">attachment</span>
                    </span>
                {% endif %}

                {% if post.getIsSecret() %}
                    <span class="glyphicon glyphicon-lock" aria-hidden="true"></span>
                    <span class="hide">secret</span>
                {% endif %}
            </a>
        </td>
        <td class="author">{{ post.getAuthor() }}</td>
        <td class="time"><time datetime="{{ post.getCreatedAt() | date('c') }}">{{ post.getCreatedAt() | date('Y-M-d') }}</time></td>
    </tr>
    {% endfor %}
    </tbody>
</table>

<div class="pager">
    {{ pager | raw }}
</div>

<div id="searchingBar">
    <form class="form-inline text-center" action="" method="GET">
    <div class="row">
        <div class="input-group">
                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                    <span class="glyphicon glyphicon-cog"></span>
                    <span class="label label-default">Subject</span>
                    <span class="label label-default">Content</span>
                    <span class="label label-default">Author</span>
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                    <li><a href="#" class="small" data-value="option1" tabIndex="-1"><input type="checkbox" name="s" {{ searchQuery['s'] ? 'checked="checked"' : '' }} />&nbsp;Subject</a></li>
                    <li><a href="#" class="small" data-value="option2" tabIndex="-1"><input type="checkbox" name="c" {{ searchQuery['c'] ? 'checked="checked"' : '' }} />&nbsp;Content</a></li>
                    <li><a href="#" class="small" data-value="option3" tabIndex="-1"><input type="checkbox" name="a" {{ searchQuery['a'] ? 'checked="checked"' : '' }} />&nbsp;Author</a></li>
                </ul>
        </div>
        <div class="input-group">
            <input type="text" name="q" placeholder="keyword" size="30" class="form-control" value="{{ searchQuery['q'] }}" required="required" />
            <span class="input-group-btn"><button class="btn btn-default" type="submit"><span class="glyphicon glyphicon-search" aria-hidden="true"></span> Search</button></span>
        </div>
    </div>
    </form>
</div>

<script type="text/javascript">
    var options = [];

    $('.dropdown-menu a').on('click', function (event) {

        var $target = $(event.currentTarget),
            val = $target.attr('data-value'),
            $inp = $target.find('input'),
            idx;

        if (( idx = options.indexOf(val) ) > -1) {
            options.splice(idx, 1);
            setTimeout(function () {
                $inp.prop('checked', false)
            }, 0);
        } else {
            options.push(val);
            setTimeout(function () {
                $inp.prop('checked', true)
            }, 0);
        }

        $(event.target).blur();

        //console.log(options);
        return false;
    });
</script>

<div class="pull-right">
    <a href="{{ createUri(board) }}" class="btn btn-default"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Write</a>
</div>
{% endblock %}
